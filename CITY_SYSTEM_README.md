# Система работы с городами для Яндекс Директ

## Описание

Эта система позволяет показывать разные номера телефонов и добавлять префикс города к ссылкам в зависимости от того, по какой ссылке пользователь перешел на сайт.

## Как это работает

1. **Определение города из URL**: Если пользователь переходит по ссылке вида `/ulyanovsk/remont-stiralnoj-mashiny.html`, система определяет город `ulyanovsk` из URL.

2. **Сохранение города**: Определенный город сохраняется в `localStorage`, чтобы при переходе на другие страницы (даже без префикса города) использовался тот же город.

3. **Замена номеров телефонов**: Все номера телефонов на странице автоматически заменяются на номер для выбранного города.

4. **Добавление префикса к ссылкам**: Все внутренние ссылки на странице автоматически получают префикс города (например, `remont-holodilnika.html` становится `/ulyanovsk/remont-holodilnika.html`).

## Настройка городов

Города настраиваются в файле `script.js` в объекте `cityConfig`:

```javascript
const cityConfig = {
    'ulyanovsk': {
        phone: '+7 (8422) 123-45-67',      // Номер для отображения
        phoneLink: '+784221234567',         // Номер для ссылки tel:
        name: 'Ульяновск'
    },
    'saratov': {
        phone: '+7 (8452) 987-65-43',
        phoneLink: '+784529876543',
        name: 'Саратов'
    },
    'default': {                            // Город по умолчанию
        phone: '+7 (812) 426-93-26',
        phoneLink: '+78124269326',
        name: 'Санкт-Петербург'
    }
};
```

### Добавление нового города

1. Добавьте новый объект в `cityConfig` с ключом в нижнем регистре (например, `'kazan'`).
2. Укажите номер телефона для отображения (`phone`) и для ссылки (`phoneLink`).
3. Укажите название города (`name`).

## Примеры использования

### Пример 1: Переход по ссылке с префиксом города

Если пользователь переходит по ссылке:
```
https://yoursite.com/ulyanovsk/remont-stiralnoj-mashiny.html
```

То:
- Все номера телефонов на странице будут заменены на номер для Ульяновска
- Все ссылки на другие страницы будут иметь префикс `/ulyanovsk/`
- Город сохранится в localStorage

### Пример 2: Переход на главную страницу без префикса

Если пользователь переходит на:
```
https://yoursite.com/index.html
```

И в localStorage уже сохранен город (например, `ulyanovsk`), то:
- Будут использованы номера телефонов для Ульяновска
- Все ссылки будут иметь префикс `/ulyanovsk/`

Если города нет в localStorage, будет использован город по умолчанию (`default`).

## Важные замечания

1. **Префикс города в URL**: Система автоматически добавляет префикс города ко всем внутренним ссылкам. Внешние ссылки, якоря (`#`) и специальные ссылки (`tel:`, `mailto:`) не изменяются.

2. **Сохранение города**: Город сохраняется в `localStorage` браузера, поэтому будет использоваться при последующих визитах на сайт (даже если пользователь зайдет без префикса города).

3. **Очистка localStorage**: Если нужно сбросить сохраненный город, можно очистить localStorage в консоли браузера:
   ```javascript
   localStorage.removeItem('selectedCity');
   ```

4. **Структура URL**: Убедитесь, что на вашем сервере настроена правильная маршрутизация для URL вида `/city/page.html`. Возможно, потребуется настройка `.htaccess` (для Apache) или конфигурации сервера.

## Настройка сервера

Для работы системы с префиксами городов в URL, вам может потребоваться настроить сервер. Пример для Apache (`.htaccess`):

```apache
RewriteEngine On
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^([^/]+)/(.+)$ $2 [L]
```

Это правило перенаправляет запросы вида `/city/page.html` на `page.html`, сохраняя при этом префикс в URL для JavaScript.

## Тестирование

Для тестирования системы:

1. Откройте сайт с префиксом города: `http://localhost/ulyanovsk/index.html`
2. Проверьте, что номера телефонов изменились
3. Проверьте, что ссылки имеют префикс `/ulyanovsk/`
4. Перейдите на другую страницу и убедитесь, что префикс сохранился
5. Очистите localStorage и проверьте работу с городом по умолчанию

